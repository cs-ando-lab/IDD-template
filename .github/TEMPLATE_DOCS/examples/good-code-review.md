# ✅ 建設的なコードレビューの例

以下は、レビューする側（レビュアー）が心がけるべき、建設的で学びのあるレビューコメントの例です。

---

## 例1: ロジックの改善提案

### ❌ 悪いコメント
```
このコードは良くないです。
```

### ✅ 良いコメント
```
このロジックだと、配列が大きい場合にパフォーマンスの問題が出る可能性があります。

現在のコード:
for (let i = 0; i < users.length; i++) {
  for (let j = 0; j < posts.length; j++) {
    // O(n²) の処理
  }
}

提案:
Map を使って O(n) に改善できます：

const userMap = new Map(users.map(u => [u.id, u]));
posts.forEach(post => {
  const user = userMap.get(post.userId);
  // ...
});

参考: https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Map
```

**良い点:**
- 問題点を具体的に指摘
- 改善案を提示
- コード例を示す
- 参考資料を添付

---

## 例2: セキュリティの指摘

### ❌ 悪いコメント
```
セキュリティホールがあります。修正してください。
```

### ✅ 良いコメント
```
⚠️ **セキュリティ懸念**: XSS攻撃の脆弱性

現在の実装だと、ユーザー入力がエスケープされずに描画されています：

<div dangerouslySetInnerHTML={{ __html: userInput }} />

提案:
1. DOMPurify でサニタイズする
2. または、dangerouslySetInnerHTML を使わずに通常のテキスト表示にする

import DOMPurify from 'dompurify';

const sanitized = DOMPurify.sanitize(userInput);
<div dangerouslySetInnerHTML={{ __html: sanitized }} />

参考:
- https://owasp.org/www-community/attacks/xss/
- https://github.com/cure53/DOMPurify
```

**良い点:**
- 深刻度が明確（⚠️ マーク）
- 具体的な問題箇所を示す
- 複数の解決策を提示
- セキュリティ情報へのリンク

---

## 例3: 設計の提案

### ❌ 悪いコメント
```
この設計は間違っています。やり直してください。
```

### ✅ 良いコメント
```
**設計についての提案**

現在の実装を見ると、状態管理のロジックがコンポーネントに密結合していますね。
今後の拡張性を考えると、以下のような分離を検討してはどうでしょうか？

【現状】
Component → 直接 Firebase 操作

【提案】
Component → Custom Hook → Service Layer → Firebase

メリット:
- テストが書きやすくなる
- 他のコンポーネントでも再利用できる
- Firebaseを別のDBに変更する場合も影響範囲が小さい

急ぎでなければ、別Issueで対応でも構いません。
この PR では現状のままでもOKです 👍

ご意見お聞かせください！
```

**良い点:**
- 現状の理解を示す
- 提案を押し付けない
- メリットを明確にする
- 柔軟な対応を許容

---

## 例4: バグの指摘

### ❌ 悪いコメント
```
バグがあります。
```

### ✅ 良いコメント
```
🐛 **潜在的なバグ**

`users` が空配列の場合、`users[0]` が `undefined` になり、
次の行で `TypeError` が発生する可能性があります：

const firstUser = users[0];
console.log(firstUser.name); // ← ここでエラー

提案:
if (users.length === 0) {
  return null; // または適切なデフォルト値
}

const firstUser = users[0];

または、Optional Chaining を使う:
console.log(users[0]?.name ?? 'Unknown');

エッジケースのテストも追加していただけると安心です 🙏
```

**良い点:**
- 問題が起こる条件を説明
- エラーの種類を明記
- 複数の解決策を提示
- テスト追加を依頼

---

## 例5: 良い実装への賞賛

### ❌ 無言承認
```
（何もコメントせず LGTM だけ押す）
```

### ✅ 良いコメント
```
👏 **素晴らしい実装です！**

特に以下の点が良いと思いました：
- エラーハンドリングが丁寧に実装されている
- テストカバレッジが高い（92%）
- 型定義が正確で、型安全性が保たれている

一点質問:
この timeout 値（5000ms）は、どういう根拠で決めましたか？
ユーザー体験の観点から適切か確認したいです。

LGTM! 🚀
```

**良い点:**
- 具体的に何が良いか指摘
- 学びを共有
- 建設的な質問を追加
- ポジティブな締め

---

## 例6: 軽微な提案

### ❌ 悪いコメント
```
変数名が良くない。
```

### ✅ 良いコメント
```
**nit (些細な提案)**: 変数名について

`data` だと何のデータか分かりにくいかもしれません。

提案: `userData` または `userProfile`

ただし、これは必須ではなく、スタイルの問題なので
チームの命名規則に従ってください 😊

Blocking ではありません。
```

**良い点:**
- nit（些細）であることを明示
- 代替案を提示
- 押し付けない
- ブロッキングでないことを明記

---

## 📋 レビューのベストプラクティス

### ✅ 心がけること
- **建設的である**: 批判ではなく改善提案
- **具体的である**: 抽象的でなく具体例を示す
- **理由を説明する**: なぜその変更が必要か
- **代替案を提示**: 「どうすべきか」を示す
- **賞賛も忘れずに**: 良い点も積極的に評価
- **質問形式にする**: 押し付けず、対話を促す
- **優先度を示す**: 必須 / 提案 / nit を区別

### ❌ 避けること
- 「これは間違っている」だけの指摘
- 人格攻撃や感情的な表現
- 根拠のない決めつけ
- 過度に細かい指摘の連続
- 無言での却下

---

## 🎯 レビューコメントのテンプレート

```markdown
**[優先度: 必須 / 提案 / nit]**: [カテゴリ]

【現状】
...現在の実装や問題点...

【提案】
...改善案やコード例...

【理由】
...なぜこの変更が必要/有益か...

【参考】
...関連するドキュメントやリンク...
```

---

詳細は [コードレビューガイド](../code-review-guide.md) も参照してください。
